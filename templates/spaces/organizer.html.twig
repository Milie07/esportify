{% extends 'base.html.twig' %}

{% block title %}Espace Organisateur ‚Äî Esportify
{% endblock %}
{% block body %}
	<div class="container-fluid mx-auto">
		{% for type, flashes in app.flashes() %}
			{% for msg in flashes %}
				<div class="alert alert-{{ type }} text-center">
					{{ msg }}
				</div>
			{% endfor %}
		{% endfor %}
		<!-- Avatar Joueur -->
		{% block img %}
			<img class="avatar avatar_player d-block mx-auto" src="{{ asset(avatarUrl) }}" alt="avatar">
		{% endblock %}

		<!-- Titre de la page -->
		<h1 class="text-center text-beige">Bienvenue
			<span>{{ app.user.pseudo }}
				<br>
				{{ app.user.memberScore}}
				üèÜ</span>
		</h1>

		<!-- Section rapports √©v√®nements -->
		<section class="container-lg my-3 my-lg-3 py-2 py-lg-3">
			<div
				class="row text_description text-center gap-2 gap-lg-0 mx-auto">

				<!-- Scores  -->
				<div class="col-12 col-lg-4">
					<div class="card bg-clair2 rounded-2 text-lightBlue p-3">
						<h2 class="card-title">Mes Scores üèÜ</h2>
						{# Favoris A venir #}
					</div>
				</div>

				<!-- Favoris -->
				<div class="col-12 col-lg-4">
					<div class="card bg-clair2 rounded-2 text-lightBlue p-3">
						<h2 class="card-title">Mes Favoris ‚≠ê</h2>
						{# Favoris A venir #}
					</div>
				</div>

				<!-- Historique -->
				<div class="col-12 col-lg-4">
					<div class="card bg-clair2 rounded-2 gap-2 text-lightBlue p-3">
						<h2>Mon Historique üìú</h2>
						{# Historique A venir #}
					</div>
				</div>

			</div>
		</section>

		<!-- Section gestion √©v√®nements -->
		<section class="container-lg  my-3 my-lg-3 py-2 py-lg-3">
			<div class="bg-clair2 rounded-2 justify-content-center p-3 mx-auto">
				<h2 class="text-center text-lightBlue mb-3">Mes Ev√®nements</h2>
				<div class="row g-4">
					{% for tournament in tournaments %}
						<div class="col-12 col-md-6 col-lg-4">
							<div class="card align-items-center mx-auto shadow-lg">
								<div class="ratio ratio-4x3 overflow-hidden">
									<img class="card-img-top object-fit-cover" src="{{ asset(tournament.getImagePath()) }}" alt="Image de {{ tournament.title }}">
								</div>
								<div class="card-body">
									<h3 class="card-title text-center text-lightBlue">{{ tournament.title }}</h3>
									<p class="text-description text-center text-darkBlue p-0 m-0">D√©marre le
										<span>{{ tournament.startAt|date('d/m/Y H:i', 'Europe/Paris') }}</span>
									</p>
									<p class="text-description text-center text-darkBlue p-0 mb-3">Se termine le
										<span>{{ tournament.endAt|date('d/m/Y H:i', 'Europe/Paris') }}</span>
									</p>

									{# BADGE DE STATUT #}
									<span class="badge rounded-pill d-block mx-auto w-50 p-2 mb-3
										{% if tournament.currentStatus.value == 'En Attente' %} bg-warning text-dark
										{% elseif tournament.currentStatus.value == 'Valid√©' %} bg-success
										{% elseif tournament.currentStatus.value == 'En Cours' %} bg-primary
										{% elseif tournament.currentStatus.value == 'Termin√©' %} bg-secondary
										{% elseif tournament.currentStatus.value == 'Refus√©' %} bg-danger
										{% endif %}">
										{{ tournament.currentStatus.value }}
									</span>

									<div class="d-flex justify-content-between ">
										<a class="btn btn-beige rounded-pill text-lightBlue" href="#">
											<span class="d-inline-block" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-trigger="hover" data-bs-content="Liste des Inscrits">
												<i class="fa-solid fa-people-group fa-2xl"></i>
											</span>
										</a>
										<a class="btn btn-beige rounded-pill text-lightBlue" href="#">
											<span class="d-inline-block" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-trigger="hover" data-bs-content="Modifier l'event">
												<i class="fa-solid fa-file-pen fa-xl"></i>
											</span>
										</a>
										{# Bouton d√©marrer : affich√© seulement si tournoi valid√© et dans les 30 min avant #}
										{% set now = "now"|date("U") %}
										{% set start = tournament.startAt|date("U") %}
										{% set diff = start - now %}
										{% if tournament.currentStatus.value == 'Valid√©' and diff <= 1800 and diff >= 0 %}
											<a class="btn btn-greenFluo rounded-pill text-lightBlue" href="#">
												<span class="d-inline-block" data-bs-toggle="popover" data-bs-placement="bottom" data-bs-trigger="hover" data-bs-content="D√©marrer l'event">
													<i class="fa-solid fa-play fa-xl"></i>
												</span>
											</a>
										{% endif %}
									</div>

								</div>
							</div>
						</div>
					{% else %}
						<p class="text-center text-lightBlue">Aucun √©v√®nement cr√©√© pour le moment.</p>
					{% endfor %}
				</div>
				<h2 class="text-center text-lightBlue fs-3 my-3">Cr√©er un √©venement üéâ</h2>
			<!-- Formulaire de Cr√©ation -->
			{% if tournamentForm is defined %}
				{{ form_start(tournamentForm, {'attr': {'class': 'form_contact bg-beige rounded-2 border border-lightBlue text_description text-lightBlue px-5 pt-4 pb-2', 'id': 'searchForm'}}) }}
					{{ form_errors(tournamentForm) }}
					<div class="mx-auto">
						{{ form_row(tournamentForm.title, {'label': 'Titre de l\'√©v√®nement :', 'attr': {'class': 'form-control input_filter mb-3'}}) }}
					</div>
					<div class="mx-auto">
						{{ form_row(tournamentForm.description, {'label': 'Description :', 'attr': {'class': 'form-control input_filter mb-3'}}) }}
					</div>
					<div class="mx-auto">
						{{ form_row(tournamentForm.tagline, {'label': 'Tagline :', 'attr': {'class': 'form-control input_filter mb-3'}}) }}
					</div>
					<div class="mx-auto">
						{{ form_row(tournamentForm.startAt, {'label': 'Date et Heure de D√©but :', 'attr': {'class': 'form-control input_filter mb-3'}}) }}
					</div>
					<div class="mx-auto">
						{{ form_row(tournamentForm.endAt, {'label': 'Date et Heure de Fin :', 'attr': {'class': 'form-control input_filter mb-3'}}) }}
					</div>
					<div class="mx-auto">
						{{ form_row(tournamentForm.capacityGauge, {'label': 'Nombre maximal de joueurs :', 'attr': {'class': 'form-control input_filter mb-3'}}) }}
					</div>
					<div class="mx-auto">
						{{ form_row(tournamentForm.tournamentImage, {'label': 'Image ou photo de l\'√©v√®nement :', 'attr': {'class': 'form-control input_filter mb-3'}}) }}
					</div>
					<div class="d-flex justify-content-center">
						<button class="btn-custom-sm-green btn btn-greenFluo" type="submit">Cr√©er</button>
					</div>
				{{ form_end(tournamentForm) }}
			{% else %}
				<p class="text-center text-lightBlue"><a href="{{ path('event_create') }}" class="btn-custom-sm-green btn btn-greenFluo">Cr√©er un tournoi</a></p>
			{% endif %}
			</div>
		</section>

		<!-- Section gestion infos perso -->
		<section class="container-lg my-3 my-lg-3 py-2 py-lg-3">
			<div class="bg-clair2 rounded-2 text-lightBlue text-center mx-auto p-3">
				<h2>Mes informations personnelles ‚úèÔ∏è</h2><!-- Formulaire d'Inscription --><formaction="#" method="POST" class="form_contact bg-beige rounded-2 border border-lightBlue text_description text-lightBlue px-5 pt-4 pb-2"><!-- Informations personnelles --><div class="w-75 mx-auto">
						<label class="" for="name">Nom :</label><input id="name" name="name" type="text" class="form-control input_filter mb-3" minlength="2" maxlength="50" value="{{ app.user.lastName }}" disabled autocomplete required></div>
					<div class="w-75 mx-auto">
						<label class="" for="surname">Pr√©nom :</label><input id="surname" name="surname" type="text" class="form-control input_filter mb-3" minlength="2" maxlength="50" value="{{ app.user.firstName }}" disabled required></div>
					<div class="w-75 mx-auto">
						<label class="" for="pseudo">Pseudo :</label><input id="pseudo" name="pseudo" type="text" class="form-control input_filter mb-3" minlength="2" maxlength="50" value="{{ app.user.pseudo }}" disabled required></div>
					<div class="w-75 mx-auto">
						<label class="" for="mail">Email :</label><input id="mail" name="mail" type="email" class="form-control input_filter mb-3" value="{{ app.user.email }}" disabled required></div>
					<div class="w-75 mx-auto">
						<label class="" for="password">Mot de Passe :</label><input id="password" name="password" type="password" class="form-control input_filter mb-3" placeholder="*********" disabled required></div>
					<div class="text-center">
						<a class="btn-custom-md-green btn btn-greenFluo align-self-center my-2" href="{{ path('modifProfile') }}">Modifier ‚öôÔ∏è</a>
					</div>
				</form>
			</div>
		</section>

		<div class="text-center mt-4">
			<a class="btn-custom-lg-clair btn btn-clair2 mb-4" href="{{ path('app_home') }}">Retour √† l'accueil</a>
		</div>
	</div>
{% endblock %}
